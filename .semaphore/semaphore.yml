version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Set-up resources
    task:
      jobs:
        - name: Clone repo
          commands:
            - checkout
            - ls -la
            - pwd

  - name: Create Containerfile
      task:
        jobs:
          commands:
            - cat << EOF > Containerfile
  - name: Install podman
      task:
        jobs:
          commands:
            - sudo apt-get -y install podman
  - name: Check all
      task:
        jobs:
        commands:
          - ls -la
          - pwd
          - env
  # - name: Container build&push
  #   task:
  #     jobs:
  - name: Build
  - dependencies: ["Clone repo", "Create Containerfile", "Install podman"]
      task:
        jobs:
          commands:
            - 'cd /home/semaphore/CD-ProJekT-UTM'
            - 'podman build . -t aleksangrrr/cdprojectutm:latest -f ./Containerfile'
  - name: Push
    depependencies: ["Build"]
      task:
        jobs:
          commands:
            - 'podman push aleksangrrr/cdprojectutm:latest'
